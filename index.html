<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRT STREAM OFFICIAL</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js"></script>
<style>
/* ===== BUTTONS - EK HI LINE MEIN LIKHNE KE LIYE FIX ===== */
.filter-buttons {
  display: flex;
  gap: 8px;
  margin: 10px 0;
  flex-wrap: nowrap; /* Isse buttons niche nahi aayenge */
  overflow-x: auto;  /* Isse side scroll ho sakega */
  padding-bottom: 5px;
  -webkit-overflow-scrolling: touch; /* Mobile smooth scroll */
}

/* Scrollbar ko chupane ke liye (optional) */
.filter-buttons::-webkit-scrollbar {
  display: none;
}

.filter-btn, .fav-btn, .my-btn, .stream-btn {
  display: inline-block;
  padding: 6px 14px;
  border-radius: 20px;
  border: 2px solid #e60000;
  background: transparent;
  color: #000;
  text-decoration: none;
  font-size: 14px;
  text-align: center;
  transition: all 0.2s;
  white-space: nowrap; /* Text ko wrap hone se rokega */
  flex-shrink: 0;      /* Buttons ko pichakne se rokega */
}

.filter-btn:hover, .fav-btn:hover, .my-btn:hover, .stream-btn:hover {
  background: rgba(230,0,0,0.2);
}
.filter-btn.active, .fav-btn.active, .my-btn.active, .stream-btn.active {
  background: #e60000;
  color: #fff;
}

/* ===== ONLY SPORTS/FAV BUTTON COLOR FIX ===== */
.fav-btn {
  background: #e60000;
  color: #fff;
}

/* ===== ONLY filter BUTTON COLOR FIX ===== */
.filter-btn {
  background: #e60000;
  color: #fff;
}

/* ===== ONLY MY BUTTON COLOR FIX ===== */
.my-btn {
  background: #e60000;
  color: #fff;
}

/* Purane header aur search-bar CSS ki jagah ye dalein */
header {
  background: #000;
  padding: 10px 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo-text {
  font-family: 'Arial Black', sans-serif;
  font-size: 20px;
  font-weight: 900;
  display: flex;
}
.logo-prt { color: #ff0000; }
.logo-stream { color: #ffcc00; }

.header-right {
  display: flex;
  align-items: center;
  gap: 12px;
}

.nav-icon {
  width: 34px;
  height: 34px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  cursor: pointer;
  color: white;
  text-decoration: none;
}

.search-circle { background: #ff0000; }
.profile-square { background: #00ff08; border-radius: 8px; }
.menu-circle { background: #333; }

#search-bar {
  display: none; /* Default me band rahega */
  width: 90%;
  margin: 10px auto;
  padding: 8px;
  border-radius: 5px;
}


/* ===== PAGE & CONTAINER ===== */
html, body {
  margin:0;
  padding:0;
  height:100%;
  font-family:system-ui;
  background:#fff;
}
#container{
  display: flex;
  flex-direction: column;
  height: 100vh;
  padding: 10px 16px;
  box-sizing: border-box;
}

/* ===== PLAYER ===== */
.shaka-video-container{
  position:relative;
  width:100%;
  height:200px;
  background:#000;
  border:2px solid #000;
  border-radius:4px;
  overflow:hidden;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  margin-bottom:10px;
}
video {
  width: 100%;
  height: 100%;
  object-fit: contain;
  background: #000;
}
#player-logo{
  position: absolute;
  top: 10px;
  right: 10px;
  width: 80px;
  opacity: 0.8;
  pointer-events: none;
  z-index:10;
}

/* ===== Show Stream Info button ===== */
#showStreamBtn {
  position: absolute;
  top: 10px;
  left: 10px;
  z-index: 20;
  padding: 4px 8px;
  background: #ffc800;
  color: #fff;
  border-radius: 6px;
  text-decoration: none;
  font-size: 12px;
}

/* ===== GRID ===== */
#grid{
  flex:1;
  overflow-y:auto;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:6px;
  padding:6px;
  background:#0026e6;
}
.item{
  background:#f2f2f2;
  padding:6px;
  border-radius:6px;
  text-align:center;
  cursor:pointer;
}
.item img{
  width:60px;
  height:60px;
  object-fit:contain;
}
.item div{
  font-size:12px;
  margin-top:4px;
}
#output{
  display:none;
  width:0;
  height:0;
  overflow:hidden;
  user-select:none;
}

@media(max-width:500px){
  header h1 { width: 100px; font-size:16px; }
  #search-bar { max-width: 120px; font-size:12px; }
  .telegram-btn { width: 90px; font-size:12px; }
}
/* Purane extra elements hide karne ke liye */
.shaka-central-play-button, .shaka-play-button-container,
.shaka-ad-controls, .shaka-all-sequences-container {
    display: none !important;
}

/* 1. Buttons panel ko horizontal rakhne aur wrap enable karne ke liye */
.shaka-controls-button-panel {
    display: flex !important;
    flex-direction: row !important; /* Buttons horizontal rahenge */
    flex-wrap: wrap !important;    /* Isse Seek bar ko upar jagah milegi */
    justify-content: center !important;
    align-items: center !important;
}

/* 2. Sirf Seek bar line ko upar bhejne ke liye */
.shaka-seek-bar-container {
    order: -1 !important;          /* Ye line ko buttons se pehle (upar) le jayega */
    width: 100% !important;        /* Poori width lene se buttons niche shift ho jayenge */
    height: 4px !important;
    margin-bottom: 12px !important; /* Buttons aur line ke beech gap */
    background: transparent !important;
}


/* Volume bar ko chota aur sahi line mein rakhne ke liye */
.shaka-volume-bar-container {
    width: 60px !important;
    background: transparent !important;
}


/* Sab kuch YELLOW karne ke liye */
.shaka-range-element::-webkit-slider-runnable-track {
    background: #00f7ff !important;
    height: 3px !important;
}

.shaka-range-element::-webkit-slider-thumb {
    appearance: none !important;
    height: 10px !important;
    width: 10px !important;
    background: #00f7ff !important;
    border-radius: 50% !important;
    margin-top: -3.5px !important;
}

.shaka-controls-container *, .shaka-spinner-path {
    color: #00f7ff !important;
    stroke: #00f7ff !important;
    fill: transparent !important;
}

/* Volume bar ka extra background hatane ke liye */
.shaka-volume-bar-container {
    background: transparent !important;
    height: 4px !important;
}

/* Beech wala spinner gayab karne ke liye */
.shaka-spinner-container {
    display: none !important;
}

/* Jab video load ho raha ho, tab play/pause button chamkega (Loading indicator) */
.shaka-play-pause-button[aria-label="buffering"] {
    color: #ff0000 !important; /* Load hote waqt red dikhega */
    animation: blinker 1s linear infinite;
}

@keyframes blinker {
    50% { opacity: 0; }
}


</style>

</style>
</head>
<body>
<header>
  <div class="logo-text">
    <span class="logo-prt">SD TV</span><span class="logo-stream">LIVE</span>
  </div>

  <div class="header-right">
    <div class="nav-icon search-circle" onclick="toggleSearch()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
    </div>
    
    <a href="" class="nav-icon profile-square" target="_blank">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 1 1-7.6-10.6 8.38 8.38 0 0 1 3.9.9L21 3z"></path></svg>
    </a>

    <div class="nav-icon menu-circle">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
    </div>
  </div>
</header>

<input type="text" id="search-bar" placeholder="Search channels...">


<div id="container">
  <div class="shaka-video-container" data-shaka-player>
    <video
  autoplay
  playsinline
  preload="metadata"
  poster="">
</video>
    <img id="player-logo" src="" alt="Logo">
    <a href="#" class="stream-btn active" id="showStreamBtn">ðŸ”¥ Sagar PLAYER ðŸ”¥</a>
  </div>

  <div id="iframeContainer" style="display:none; width:100%; height:200px; margin-bottom:10px;">
    <iframe id="contentFrame"
      src=""
      style="width:100%; height:100%; border:none;"
      allowfullscreen>
    </iframe>
  </div>

  <div class="filter-buttons">
      <a href="#" class="my-btn" id="indNzBtn">Wpl Hindi</a>
    <a href="#" class="filter-btn">WPL NS</a>

    <a href="#" class="fav-btn active" id="allBtn">All</a>
    <a href="#" class="fav-btn" id="moviesBtn">Movies</a>
    <a href="#" class="fav-btn" id="musicBtn">Music</a>
    <a href="#" class="fav-btn" id="sportsBtn">Sports</a>
  

  </div>


  <div id="grid"></div>
</div>

<div id="output">Click any channel to see MPD / Cookie / Key</div>

<script>

function toggleSearch() {
  const sb = document.getElementById('search-bar');
  if (sb.style.display === 'block') {
    sb.style.display = 'none';
  } else {
    sb.style.display = 'block';
    sb.focus();
  }
}


const M3U_URL = "https://rkdyiptv.pages.dev/Playlist/Cricket.m3u";
const grid = document.getElementById("grid");
const searchBar = document.getElementById("search-bar");
let player, video, drmConfig, cookieHeader, streamUrl;
let posterTimer = null;
const POSTER_URL = "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj4d15fUe-vcHVWc6gGbyYCUKvvaYJL6p4-DRzZOHelviACF-ixD0OEQpYkExUx6P03jQNn2YHrEyWSKoFCs7nwfccGYW6Xd9hZ2qVhQunqdjfwzv_Oa5sWCLDVdFbpye3APooLvkFW1Z_rlp80Y9Y3kBPncr2ExVYCrp3QtvH-Lfih2hxizGpp8_pdAwA/s16000/1000149859.gif";
let allChannels = [];

document.addEventListener('DOMContentLoaded', async () => {
  shaka.polyfill.installAll();
  video = document.querySelector('video');
  player = new shaka.Player();
  await player.attach(video);

  const container = document.querySelector('.shaka-video-container');
  const ui = new shaka.ui.Overlay(player, container, video);

ui.configure({
    // ... baki colors wahi rahenge ...
    controlPanelElements: [
      'play_pause',          /* Pehle Play button */
      'time_and_duration',   /* Phir Time */
      'spacer',              /* Spacer beech mein gap ke liye */
      'mute',                /* Mute button */
      'volume',              /* Volume bar */
      'quality',
      'picture_in_picture',              /* Settings */
      'fullscreen'           /* Fullscreen */
    ]
});
// Loading dikhane ke liye logic
player.addEventListener('buffering', (event) => {
    const playButton = document.querySelector('.shaka-play-pause-button');
    if (event.buffering) {
        playButton.style.opacity = "0.5"; // Play button dhundla ho jayega jab load hoga
        playButton.style.border = "2px solid #00f7ff"; // Loading indicator jaisa border
    } else {
        playButton.style.opacity = "1";
        playButton.style.border = "none";
    }
});






  player.getNetworkingEngine().registerRequestFilter((type, request) => {
    request.headers['Referer'] = 'https://www.jiotv.com/';
    request.headers['Origin'] = 'https://www.jiotv.com';
    request.headers['User-Agent'] = "plaYtv/7.1.5 (Linux;Android 13) ExoPlayerLib/2.11.6";
    if(cookieHeader) request.headers['Cookie'] = cookieHeader;

    if (
      (type === shaka.net.NetworkingEngine.RequestType.MANIFEST ||
       type === shaka.net.NetworkingEngine.RequestType.SEGMENT) &&
      cookieHeader && !request.uris[0].includes('__hdnea__=')
    ){
      const sep = request.uris[0].includes('?') ? '&' : '?';
      request.uris[0] += sep + cookieHeader;
    }
  });

  const res = await fetch(M3U_URL);
  const text = await res.text();
  const lines = text.split("\n");
  let current = {};
  let autoPlayChannel = null;

  for(let i=0;i<lines.length;i++){
    const line = lines[i].trim();
    if(line.startsWith("#EXTINF")){
      current={};
      current.name = line.split(",").pop();
      const logo = line.match(/tvg-logo="([^"]+)"/);
      current.logo = logo ? logo[1] : "";
      const lic = line.match(/license_key="?([a-f0-9]+:[a-f0-9]+)"?/i);
      current.key = lic ? lic[1] : "-";
      const ck = line.match(/cookie="?([^"]+)"?/i);
      current.cookie = ck ? ck[1] : "-";
    }
    if(current.key === "-"){
      for(let j=i+1;j<=i+2 && j<lines.length;j++){
        const l = lines[j];
        const k2 = l.match(/license_key="?([a-f0-9]+:[a-f0-9]+)"?/i);
        if(k2){ current.key = k2[1]; break; }
      }
    }
    if(line.startsWith("#EXTHTTP") && line.includes("cookie")){
      const ck2 = line.match(/"cookie":"([^"]+)"/);
      if(ck2) current.cookie = ck2[1];
    }
    if(line.startsWith("http") && current.name){
      current.mpd = line;
      if(line.includes("keyId=") && line.includes("key=")){
        const kid = line.match(/keyId=([a-f0-9]+)/i);
        const key = line.match(/key=([a-f0-9]+)/i);
        if(kid && key) current.key = kid[1]+":"+key[1];
      }
      allChannels.push({...current});
      createItem(current);

      if(!autoPlayChannel && current.name.toLowerCase().includes("Star Sports HD1")){
        autoPlayChannel = {...current};
      }

      current={};
    }
  }

  if(autoPlayChannel){
    loadChannel(autoPlayChannel);
  }

  const buttonChannels = {
    "WPL NS": "willow",
    "BBL": "Star Sports HD2",
  };

  const filterButtons = document.querySelectorAll('.filter-btn');
  filterButtons.forEach(btn => {
    btn.addEventListener('click', async (e)=>{
      e.preventDefault();
      const btnText = btn.textContent.trim();
      const channelName = buttonChannels[btnText];
      if(!channelName) return;
      const ch = allChannels.find(c => c.name.toLowerCase() === channelName.toLowerCase());
      if(ch) loadChannel(ch);
    });
  });
});

function createItem(ch){
  const div = document.createElement("div");
  div.className="item";
  div.innerHTML = `<img src="${ch.logo}"><div>${ch.name}</div>`;
  div.onclick = async ()=>{
    loadChannel(ch);
  };
  grid.appendChild(div);
}

async function loadChannel(ch){
  showPlayer();

  // default poster reset
  video.poster = "";

  // purana timer clear
  if (posterTimer) clearTimeout(posterTimer);

  // 7 second baad sirf tab poster change jab video play na ho
  posterTimer = setTimeout(()=>{
    if (video.paused || video.readyState < 3) {
      video.poster = POSTER_URL;
    }
  },5000);

  streamUrl = ch.mpd;
  cookieHeader = ch.cookie;
  drmConfig = { clearKeys:{} };
  if(ch.key && ch.key !== "-"){
    const [kid,key] = ch.key.split(":");
    drmConfig.clearKeys[kid] = key;
  }
  try{
    await player.configure({drm:drmConfig});
    await player.load(streamUrl);
  }catch(e){ console.error(e); }
}

searchBar.addEventListener("input", ()=>{
  const searchTerm = searchBar.value.toLowerCase();
  grid.innerHTML = "";
  allChannels
    .filter(ch => ch.name.toLowerCase().includes(searchTerm))
    .forEach(ch => createItem(ch));
});

// SPORTS FILTER
const sportsBtn = document.getElementById('sportsBtn');
sportsBtn.addEventListener('click', (e) => {
  e.preventDefault();
  grid.innerHTML = "";
  allChannels
    .filter(ch => ch.name.toLowerCase().includes("sport"))
    .forEach(ch => createItem(ch));
  document.querySelectorAll('.filter-btn, .fav-btn, .my-btn').forEach(b => b.classList.remove('active'));
  sportsBtn.classList.add('active');
});

// ALL FILTER
document.getElementById('allBtn').addEventListener('click', (e) => {
  e.preventDefault();
  grid.innerHTML = "";
  allChannels.forEach(ch => createItem(ch));
  document.querySelectorAll('.filter-btn, .fav-btn, .my-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('allBtn').classList.add('active');
});

// MOVIES FILTER
document.getElementById('moviesBtn').addEventListener('click', (e) => {
  e.preventDefault();
  grid.innerHTML = "";
  allChannels
    .filter(ch => ch.name.toLowerCase().includes("movie") || ch.name.toLowerCase().includes("cinema") || ch.name.toLowerCase().includes("action"))
    .forEach(ch => createItem(ch));
  document.querySelectorAll('.filter-btn, .fav-btn, .my-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('moviesBtn').classList.add('active');
});

// MUSIC FILTER
document.getElementById('musicBtn').addEventListener('click', (e) => {
  e.preventDefault();
  grid.innerHTML = "";
  allChannels
    .filter(ch => ch.name.toLowerCase().includes("music") || ch.name.toLowerCase().includes("songs") || ch.name.toLowerCase().includes("zing") || ch.name.toLowerCase().includes("mtv"))
    .forEach(ch => createItem(ch));
  document.querySelectorAll('.filter-btn, .fav-btn, .my-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('musicBtn').classList.add('active');
});

const shakaContainer = document.querySelector('.shaka-video-container');
const iframeContainer = document.getElementById('iframeContainer');
const iframe = document.getElementById('contentFrame');

// 1. WPL Hindi Button ka logic (Isme Iframe URL hai)
document.getElementById("indNzBtn").addEventListener("click", (e)=>{
  e.preventDefault();
  // Ye raha aapka Iframe URL
  showIframe("ply.html");
});

// 2. Iframe ko dikhane aur purana video PAUSE karne ka logic
function showIframe(url){
  const shakaContainer = document.querySelector('.shaka-video-container');
  const iframeContainer = document.getElementById('iframeContainer');
  const iframe = document.getElementById('contentFrame');

  // Video ko pause karne ke liye ye line zaroori hai
  if (video) {
    video.pause(); 
  }

  shakaContainer.style.display = "none";
  iframeContainer.style.display = "block";
  iframe.src = url;
}

// 3. Iframe ko band karke wapas player dikhane ka logic
function showPlayer(){
  const shakaContainer = document.querySelector('.shaka-video-container');
  const iframeContainer = document.getElementById('iframeContainer');
  const iframe = document.getElementById('contentFrame');
  
  iframe.src = ""; // Isse WPL ki awaz band ho jayegi
  iframeContainer.style.display = "none";
  shakaContainer.style.display = "block";
}

const showStreamBtn = document.getElementById("showStreamBtn");
showStreamBtn.addEventListener("click", (e) => {
    e.preventDefault();
    if (!streamUrl) {
        alert("Abhi koi channel play nahi ho raha.");
        return;
    }
    let drmString = "";
    if (drmConfig && drmConfig.clearKeys && Object.keys(drmConfig.clearKeys).length > 0) {
        const kid = Object.keys(drmConfig.clearKeys)[0];
        const key = drmConfig.clearKeys[kid];
        drmString = `&drmScheme=clearkey&drmLicense=${kid}:${key}`;
    }
    const cookieString = cookieHeader ? `|Cookie=${cookieHeader}` : "";
    const finalUrl = `intent:${streamUrl}${cookieString}${drmString}#Intent;package=com.genuine.leone;end`;
    window.location.href = finalUrl;
});

function handleFullscreenChange() {
  const isFullscreen = document.fullscreenElement || document.webkitFullscreenElement;
  nsBtn.style.display = isFullscreen ? "none" : "inline-block";
}
document.addEventListener("fullscreenchange", handleFullscreenChange);
document.addEventListener("webkitfullscreenchange", handleFullscreenChange);
</script>
</body>
</html>
